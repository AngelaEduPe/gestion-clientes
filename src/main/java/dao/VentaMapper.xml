<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.VentaMapper">
    <resultMap id="VentaMap" type="models.Venta">
        <id column="id_venta" property="idVenta" />
        <result column="monto" property="monto" />
        <result column="fecha" property="fecha" />
        <result column="estado" property="estado" />

        <association property="cliente" javaType="models.Cliente">
            <id column="id_cliente" property="idCliente" />
            <result column="nombre" property="nombre" />
            <result column="apellido" property="apellido" />
        </association>

        <association property="oportunidad" javaType="models.Oportunidad">
            <id column="id_oportunidad" property="idOportunidad" />
            <result column="monto_estimado" property="montoEstimado" />
            <result column="estado" property="estadoOportunidad" />
        </association>
    </resultMap>

    <select id="listarVentas" resultMap="VentaMap">
        SELECT 
            v.id_venta, v.id_cliente, v.id_oportunidad, v.monto, v.fecha, v.estado,
            c.id_cliente, c.nombre, c.apellido,
            o.id_oportunidad, o.monto_estimado, o.estado AS estadoOportunidad
        FROM Venta v
        JOIN Cliente c ON v.id_cliente = c.id_cliente
        LEFT JOIN Oportunidad o ON v.id_oportunidad = o.id_oportunidad;
    </select>
</mapper>
